@startuml Auto Recommendation Sequence Diagram

' Styling
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 150
skinparam sequenceParticipant underline

' Actors and Participants
actor User
participant "Frontend\n(React)" as Frontend
participant "RoomController" as Controller
participant "RoomServiceImpl" as Service
participant "BookingRepository" as BookingRepo
participant "RoomRepository" as RoomRepo

' Sequence Flow
User -> Frontend: 1. Visit Homepage
activate Frontend

Frontend -> Controller: 2. GET /api/rooms/recommend?type=auto&limit=5
activate Controller

Controller -> Controller: 3. Create RoomRecommendRequest\n(null, "auto", 5)

Controller -> Service: 4. recommendRooms(request)
activate Service

alt type = "auto" && accountId = null
    Service -> BookingRepo: 5. countBookingsByRoom()
    activate BookingRepo
    BookingRepo --> Service: 6. List<[roomId, count]>
    deactivate BookingRepo
    
    alt bookingStats exist
        Service -> Service: 7. Extract top room IDs
        Service -> RoomRepo: 8. findAllById(topRoomIds)
        activate RoomRepo
        RoomRepo --> Service: 9. List<RoomEntity>
        deactivate RoomRepo
        Service -> Service: 10. Filter by status='available'
    else no bookingStats
        Service -> RoomRepo: 11. findForList(status='available')
        activate RoomRepo
        RoomRepo --> Service: 12. List<RoomEntity>
        deactivate RoomRepo
    end
end

Service -> Service: 13. Filter by isVisible=true
Service -> Service: 14. Limit to 5 rooms
Service -> Service: 15. Map to Room DTOs

Service --> Controller: 16. List<Room>
deactivate Service

Controller --> Frontend: 17. JSON Response (200 OK)
deactivate Controller

Frontend -> Frontend: 18. Display in Carousel

Frontend --> User: 19. Show Recommended Rooms
deactivate Frontend

@enduml

